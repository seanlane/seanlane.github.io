<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Sean Lane">
    <meta name="description" content="Sean Lane&#39;s personal website">
    <meta name="keywords" content="blog,developer,personal,software,engineer,utah">

    
    <title>
  Installing Linux on a Microsoft Surface 3 · Sean Lane
</title>

    <link rel="canonical" href="https://sean.lane.sh/posts/2018/01/Installing-Linux-on-a-Microsoft-Surface-3/">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/grids-responsive-min.css">
  
    
    
    <link rel="stylesheet" href="https://sean.lane.sh/css/coder.min.f1211b4ed23b57b3f430d3bf2f297317076a8af695c889860f420b16dc57158d.css" integrity="sha256-8SEbTtI7V7P0MNO/LylzFwdqivaVyImGD0ILFtxXFY0=" crossorigin="anonymous" media="screen" />
  
  
  
  
    <link rel="stylesheet" href="https://sean.lane.sh/style.css">
  
    <link rel="icon" type="image/png" href="https://sean.lane.sh/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://sean.lane.sh/images/favicon-16x16.png" sizes="16x16">
  <meta name="generator" content="Hugo 0.121.1">
    <script src="//instant.page/1.2.1" type="module" integrity="sha384-/IkE5iZAM/RxPto8B0nvKlMzIyCWtYocF01PbGGp1qElJuxv9J4whdWBRtzZltWn"></script>
  </head>
  <body class=" ">
    <nav class="navigation pure-g">
  <section class="pure-u-1 pure-u-md-1-3">
    <div class="nav-left">
      
        <a class="nav-avatar" href="https://sean.lane.sh">
          <img src="https://sean.lane.sh/images/sean.png" alt="avatar" />
        </a>
      
      <a class="nav-title" href="https://sean.lane.sh">
        Sean Lane
      </a>
    </div>
  </section>
  <section class="pure-u-1 pure-u-md-1-3 nav-center">
    
      
        <a href="mailto:hi@sean.lane.sh"><i class="far fa-envelope fa-lg"></i></a>
      
        <a href="https://github.com/seanlane/"><i class="fab fa-github fa-lg"></i></a>
      
        <a href="https://www.linkedin.com/in/seantheolane"><i class="fab fa-linkedin fa-lg"></i></a>
      
        <a href="https://sean.lane.sh/posts/index.xml"><i class="fas fa-rss fa-lg"></i></a>
      
        <a href="https://twitter.com/seantheolane"><i class="fab fa-twitter fa-lg"></i></a>
      
    
  </section>
  <section class="pure-u-1 pure-u-md-1-3 nav-right">
    
      
        <a href="https://sean.lane.sh/">Home</a>
      
        <a href="https://sean.lane.sh/resume/">Resume</a>
      
        <a href="https://sean.lane.sh/posts/">Posts</a>
      
        <a href="https://sean.lane.sh/other/">Other</a>
      
    
  </section>
</nav>

    <main class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Installing Linux on a Microsoft Surface 3</h1>
        </div>
        <div class="post-meta pure-g">
          <div class="posted-on pure-u-1 pure-u-sm-1-3">
            <i class="fas fa-calendar"></i>
            <time datetime='2018-01-26T00:00:00Z'>
              January 26, 2018
            </time>
          </div>
          <div class="reading-time pure-u-1 pure-u-sm-1-3 post-center">
            <i class="fas fa-clock"></i>
            Reading time: 7 minutes
          </div>
          <div class="pure-u-1 pure-u-sm-1-3 post-right">
            
            <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://sean.lane.sh/tags/linux/">Linux</a>
      <span class="separator">•</span>
    <a href="https://sean.lane.sh/tags/cli/">CLI</a></div>

          </div>
        </div>
      </header>
      <div>
        <p><em>Update: April 22, 2020</em></p>
<p>This post as it stands is pretty outdated, though I currently don&rsquo;t have the time to fix that. Read this comment for an idea of how things are at the moment:</p>
<p><a href="https://github.com/seanlane/seanlane.github.io/issues/6#issuecomment-617574939">https://github.com/seanlane/seanlane.github.io/issues/6#issuecomment-617574939</a></p>
<p>TL;DR: Go checkout this project for the latest kernel: <a href="https://github.com/linux-surface/linux-surface">https://github.com/linux-surface/linux-surface</a></p>
<p><em>Update: July 23, 2019</em></p>
<p>I came back to this after a hiatus, and finally finished a relevant install of Linux on my Surface 3. I abandoned the effort to use Arch Linux, opting instead to try <a href="https://elementary.io/">ElementaryOS</a> since the main purpose of this device will be for some children to use during long car rides.</p>
<h2 id="install-elementary-os">Install Elementary OS</h2>
<p>The installation itself was easy:</p>
<ol>
<li>Disable Secure Boot as originally described below</li>
<li>Install ElementaryOS to a USB drive: <a href="https://elementary.io/docs/installation#creating-an-installation-medium">https://elementary.io/docs/installation#creating-an-installation-medium</a></li>
<li>Insert the USB drive into the Surface and boot to USB:</li>
</ol>
<ul>
<li>Turn off the Surface 3</li>
<li>Press and hold the volume-down button</li>
<li>Press and release the power button</li>
<li>When the Surface logo appears, release the volume-down button</li>
</ul>
<ol start="4">
<li>Follow the install instructions</li>
</ol>
<p><strong>Warning:</strong> As I discuss below, following these steps will obliterate the Windows partition, since I don&rsquo;t care to keep it. If you&rsquo;re trying to dual boot Linux and Windows, you&rsquo;ll have to find further instructions on that elsewhere.</p>
<h2 id="use-jake-days-surface-kernel">Use Jake Day&rsquo;s Surface kernel</h2>
<p>This project from Jake Day makes this entire effort reasonably painless: <a href="https://github.com/jakeday/linux-surface">https://github.com/jakeday/linux-surface</a></p>
<p>While not explictly supporting the Surface 3, it does seem to work when using kernel release 4.19.18:</p>
<ul>
<li>Using releases after 4.19.18 appear to not correctly recognize the battery on the Surface 3, so you can&rsquo;t display a battery percentage (Related issue: <a href="https://github.com/jakeday/linux-surface/issues/452">https://github.com/jakeday/linux-surface/issues/452</a>)</li>
<li>Using releases before 4.19.18 gave me issues with audio not functioning</li>
</ul>
<p>Kernel 4.19.18 seems to be the sweet spot of having both audio and the battery indicator functioning, and I haven&rsquo;t noticed other issues yet. I haven&rsquo;t bothered to get the Surface Pen to work, but the touchscreen and TypeCover both seem to work well.</p>
<p>Following the instructions from the project README are easy enough:</p>
<ol>
<li>Find your chosen version from the release page:</li>
</ol>
<ul>
<li><a href="https://github.com/jakeday/linux-surface/releases">https://github.com/jakeday/linux-surface/releases</a></li>
<li>My instructions will show 4.19.18, change for your purposes as required:
<ul>
<li><a href="https://github.com/jakeday/linux-surface/releases/tag/4.19.18-1">https://github.com/jakeday/linux-surface/releases/tag/4.19.18-1</a></li>
</ul>
</li>
</ul>
<ol start="2">
<li>Download the appropriate <code>linux-headers</code>, <code>linux-image</code>, and <code>linux-libc-</code> files, then verify using the corresponding MD5 files</li>
<li>Install using dpkg:</li>
</ol>
<ul>
<li><code>sudo dpkg -i linux-headers-[VERSION].deb linux-image-[VERSION].deb linux-libc-dev-[VERSION].deb</code></li>
</ul>
<p>That&rsquo;s pretty as far as I&rsquo;m planning to take it, seems like it works pretty well at this point.</p>
<figure><img src="https://sean.lane.sh/images/2018/01/surface-linux.png"
         alt="Action Shot of the Surface 3 running Elementary OS"/><figcaption>
            <p>Action Shot of the Surface 3 running Elementary OS</p>
        </figcaption>
</figure>

<hr>
<p>A few years ago, I was given a Microsoft Surface 3 tablet that has since fallen into disuse. I was appreciative of the gift, though to be honest the Intel Atom CPU it came with is fairly underpowered when it comes to running Windows 10, so I decided to install a light Linux distro on it to get the tablet back into running order. I came across the blog post <a href="https://blog.chadvoegele.com/posts/post2.html">Running Arch Linux on a Surface 3</a> by <a href="http://www.chadvoegele.com/">Chad Voegele</a>, which was fairly useful in getting started, and I wanted to write a post of my own to share some addition details and places where I diverged from Chad&rsquo;s post along the way.</p>
<p>The biggest  difference is that I had no intentions of dual booting Windows alongside Linux, so I disregarded any shrinking of the Windows partition or having to consolidate the Windows partition into one part of the SSD. Past that, I followed the overall path that Chad outlines with some minor modifications/details.</p>
<h1 id="disable-secure-boot">Disable Secure Boot</h1>
<p>We&rsquo;ll first need to disable the Secure Boot feature that checks installed kernels against an approved list, since we&rsquo;re installing one that one be pre-approved by Microsoft.</p>
<ol>
<li>From the powered off state, hold the volume up button, press and then release the power button, and keep holding the volume up button until the BIOS screen appears</li>
<li>Using the keyboard, go to the Secure Boot option, press enter to show the selection dialog, and then select Disable to disable Secure Boot</li>
<li>From the BIOS screen, also change the <a href="https://support.microsoft.com/en-us/help/4023511/surface-boot-surface-from-a-usb-device?os=windows-10&amp;=undefined">boot order</a> from <code>SSD</code> to <code>Network &gt; USB &gt; SSD</code> before moving on</li>
</ol>
<h1 id="install-arch-linux">Install Arch Linux</h1>
<p>First <a href="https://wiki.archlinux.org/index.php/USB_flash_installation_media">install Arch Linux to a USB drive</a> and then follow the Arch Linux wiki&rsquo;s excellent <a href="https://wiki.archlinux.org/index.php/installation_guide">installation guide</a>. I didn&rsquo;t have any problems with verifying that the Surface booted in UEFI mode or with the keyboard, but I did have to fight with the WiFi</p>
<h2 id="wpa-2-enterprise-wifi-on-the-surface-3-from-arch-linux">WPA 2 Enterprise WiFi on the Surface 3 from Arch Linux</h2>
<p>The BYU CS department where I was performing this operation uses WPA2 Enterprise for their wifi network, which made things a bit more complicated. From the <a href="https://wiki.archlinux.org/index.php/WPA_supplicant#Advanced_usage">WPA_supplicant page</a> I found the the following WPA_supplicant configuration file allowed for connection to the network (_Note:_ You&rsquo;d need to replace the text in between and including the angle brackets with your relevant information):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># File: /etc/wpa_supplicant/wpa_supplicant.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ctrl_interface=DIR=/run/wpa_supplicant
</span></span><span style="display:flex;"><span>ap_scan=1
</span></span><span style="display:flex;"><span>fast_reauth=1
</span></span><span style="display:flex;"><span>network={
</span></span><span style="display:flex;"><span>  scan_ssid=1
</span></span><span style="display:flex;"><span>  ssid=&#34;&lt;ssid&gt;&#34;                     # Replace this
</span></span><span style="display:flex;"><span>  key_mgmt=WPA-EAP
</span></span><span style="display:flex;"><span>  eap=PEAP
</span></span><span style="display:flex;"><span>  identity=&#34;&lt;username&gt;&#34;             # Replace this
</span></span><span style="display:flex;"><span>  anonymous_identity=&#34;&lt;username&gt;&#34;   # Replace this
</span></span><span style="display:flex;"><span>  password=&#34;&lt;password&gt;&#34;             # Replace this
</span></span><span style="display:flex;"><span>  phase1=&#34;peaplabel=0&#34;
</span></span><span style="display:flex;"><span>  phase2=&#34;auth=MSCHAPV2&#34;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Then, with my wifi adapter being located at <code>/dev/wlp1s0</code>, the following commands brought up the adapter, configured <code>wpa_supplicant</code>, and then obtained an IP address via DHCP:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># ip link set dev wlp1s0 up
</span></span><span style="display:flex;"><span># wpa_supplicant -B -i wlp1s0 -c /etc/wpa_supplicant/wpa_supplicant.conf
</span></span><span style="display:flex;"><span># dhcpcd wlp1s0
</span></span></code></pre></div><h2 id="partitioning-the-ssd">Partitioning the SSD</h2>
<p>Continuing through the <a href="https://wiki.archlinux.org/index.php/installation_guide#Format_the_partitions">installation instructions</a>, the next bit of trouble I had was with partitioning the SSD. Again, I didn&rsquo;t care about not erasing the Windows partition since I do not want to dual boot Windows and Linux, so I erased the partition table for the drive and started to create my own. The problem that I ran into was that <code>gdisk</code> did not seem to correctly write the new partition table, but using <code>parted</code> did. If the SSD for my Surface was located at <code>/dev/sdX</code> (change as needed to your correct device name, which you can find by running <code># fdisk -l</code>), then I used the following commands to delete the old partition table, create a new one, and then create</p>
<ol>
<li>The EFI System Partition (ESP)</li>
<li>A swap partition</li>
<li>A single root partition</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># parted /dev/sdX
</span></span><span style="display:flex;"><span>(parted) print                                      # View existing partitions
</span></span><span style="display:flex;"><span>(parted) rm x                                       # Replace x with partition number
</span></span><span style="display:flex;"><span>                                                    # Remove all of the partitions
</span></span><span style="display:flex;"><span>(parted) mklabel gpt                                # Create new GPT table
</span></span><span style="display:flex;"><span>(parted) mkpart ESP fat32 1MiB 550MiB               # ESP part. w/ 550 MB
</span></span><span style="display:flex;"><span>(parted) set 1 boot on                              # Set as ESP (boot) partition
</span></span><span style="display:flex;"><span>(parted) mkpart primary linux-swap 550MiB 1.5GiB    # Swap partition w/ ~1GB
</span></span><span style="display:flex;"><span>(parted) mkpart primary ext4 1.5GiB 100%            # Remaining space to root/home part.
</span></span></code></pre></div><h2 id="formatting-the-partitions">Formatting the partitions</h2>
<p>Continue with the <a href="https://wiki.archlinux.org/index.php/installation_guide#Format_the_partitions">installation instructions</a> to format the partitions:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># mkfs.vfat /dev/sdX1
</span></span><span style="display:flex;"><span># mkswap /dev/sdX2
</span></span><span style="display:flex;"><span># swapon /dev/sdX2
</span></span><span style="display:flex;"><span># mkfs.ext4 /dev/sdX3
</span></span></code></pre></div><h2 id="mount-the-partitions">Mount the partitions</h2>
<p>Next, we&rsquo;ll mount our root partition and then the ESP:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># mount /dev/sdX3 /mnt
</span></span><span style="display:flex;"><span># mkdir /mnt/boot
</span></span><span style="display:flex;"><span># mount /dev/sdX1 /mnt/boot
</span></span></code></pre></div><h2 id="boot-loader">Boot loader</h2>
<p>I continued with the <a href="https://wiki.archlinux.org/index.php/installation_guide">installation instructions</a> without any deviations until reaching the <a href="https://wiki.archlinux.org/index.php/installation_guide#Boot_loader">Boot loader section</a>. From the bash shell on your mounted partition (where you should already be by running <code># arch-chroot /mnt</code>), follow the recommendations to install the <a href="https://www.archlinux.org/packages/?name=intel-ucode">intel-ucode</a> package:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># pacman -S intel-ucode
</span></span></code></pre></div><p>Then exit the bash terminal from your mounted partition, which will return you to the zsh session from the Arch Linux on your USB drive. From here, we&rsquo;ll need to find the partition UUID, as described in the <a href="https://wiki.archlinux.org/index.php/Systemd-boot#Configuration">Systemd-boot page</a></p>
<blockquote>
<p>You can find the PARTUUID for your root partition with the command <code>blkid -s PARTUUID -o value /dev/sdxY</code>, where <code>x</code> is the device letter and <code>Y</code> is the partition number. This is required only for your root partition, not esp.</p>
</blockquote>
<p>Run the indicated command, then replace <code>XXXX</code> in the code segment below with the appropriate UUID, and then save the file at <code>/mnt/boot/loader/entries/arch.conf</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>title   Arch Linux
</span></span><span style="display:flex;"><span>linux   /vmlinuz-linux
</span></span><span style="display:flex;"><span>initrd  /intel-ucode.img
</span></span><span style="display:flex;"><span>initrd  /initramfs-linux.img
</span></span><span style="display:flex;"><span>options root=PARTUUID=XXXX rootfstype=ext4 add_efi_memmap
</span></span></code></pre></div><p>Note that we added an additional <code>initrd</code> line to <a href="https://wiki.archlinux.org/index.php/Microcode#systemd-boot">enable the Intel microcode updates</a> in conjunction with the <code>intel-ucode</code> package we previously installed.</p>
<h2 id="finish-up">Finish Up</h2>
<p>With that done, continue with the last bit of the installation instructions to unmount the partitions as needed and reboot. That should allow you to reboot from your Surface SSD into an Arch Linux shell.</p>
<h1 id="conclusion">Conclusion</h1>
<p>This is as far as I&rsquo;ve gotten at the moment, due to competing commitments with my time. As I go further with the install, to include a desktop environment, I&rsquo;ll update this post to reflect those changes and anything else I find. Chad&rsquo;s blog post continues with some excellent tips on how to improve the day-to-day user experience with the Surface running Arch Linux, and the Arch Linux wiki will have further instructions on other things you might want to do on your own.</p>

      </div>
      <div id="comments" class="comments">
    <h2>Comments</h2>
    <div id="comments-preamble">
        To leave a comment, <a href="https://github.com/seanlane/seanlane.github.io/issues/6">visit this post's issue page on GitHub.</a> 
        A GitHub account is required, since <a href="https://sean.lane.sh/posts/2016/01/Hosting-comments-within-issues-on-Github-Pages/">I host this site's comments on GitHub.</a>
    <div>
</div>
<script type="text/javascript" src="https://unpkg.com/jquery@3.3.1/dist/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js"></script>
<script type="text/javascript">
  function loadComments(data) {
    for (var i=0; i < data.length; i++) {
      var cuser = data[i].user.login;
      var cuserlink = "https://www.github.com/" + data[i].user.login;
      var clink = "https://github.com/seanlane\/seanlane.github.io/issues/6#issuecomment-" + 
          data[i].url.substring(data[i].url.lastIndexOf("/") + 1);
      var cbody = data[i].body_html;
      var cavatarlink = data[i].user.avatar_url;
      var cdate = Date.parse(data[i].created_at).setTimezone('UTC').toString("yyyy-MM-dd HH:mm:ss");

      $("#comments").append("<div class='comment'><div class='commentheader'><div class='commentgravatar'>" 
        + '<img src="' + cavatarlink + '" alt="" width="20" height="20">' 
        + "</div><a class='commentuser' href=\"" + cuserlink + "\">" 
        + cuser + "</a><a class='commentdate' href=\"" + clink 
        + "\">" + cdate + "</a></div><div class='commentbody'>" + cbody + "</div></div>");
    }
  }

  $.ajax("https://api.github.com/repos/seanlane\/seanlane.github.io/issues/6/comments", {
    headers: {Accept: "application/vnd.github.full+json"},
    success: function(msg){
      loadComments(msg);
    }
  });
</script>
      <footer>
        
      </footer>
    </article>
    
  </section>

    </main>
    <footer class="footer">
  
   © 2024
  
     · 
    Powered by <a href="https://gohugo.io/">Hugo</a> &amp; Extended from <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>
  
  
</footer>

    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-31520487-4', 'auto');
	
	ga('send', 'pageview');
}
</script>
  </body>
</html>