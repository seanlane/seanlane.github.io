<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Sean Lane">
    <meta name="description" content="Sean Lane&#39;s personal website">
    <meta name="keywords" content="blog,developer,personal,software,engineer,utah">

    
    <title>
  Odd Attribute Error from AWS boto3 · Sean Lane
</title>

    <link rel="canonical" href="https://sean.lane.sh/posts/2019/07/Odd-Attribute-Error-from-AWS-boto3/">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/grids-responsive-min.css">
  
    
    
    <link rel="stylesheet" href="https://sean.lane.sh/css/coder.min.f1211b4ed23b57b3f430d3bf2f297317076a8af695c889860f420b16dc57158d.css" integrity="sha256-8SEbTtI7V7P0MNO/LylzFwdqivaVyImGD0ILFtxXFY0=" crossorigin="anonymous" media="screen" />
  
  
  
  
    <link rel="stylesheet" href="https://sean.lane.sh/style.css">
  
    <link rel="icon" type="image/png" href="https://sean.lane.sh/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://sean.lane.sh/images/favicon-16x16.png" sizes="16x16">
  <meta name="generator" content="Hugo 0.121.1">
    <script src="//instant.page/1.2.1" type="module" integrity="sha384-/IkE5iZAM/RxPto8B0nvKlMzIyCWtYocF01PbGGp1qElJuxv9J4whdWBRtzZltWn"></script>
  </head>
  <body class=" ">
    <nav class="navigation pure-g">
  <section class="pure-u-1 pure-u-md-1-3">
    <div class="nav-left">
      
        <a class="nav-avatar" href="https://sean.lane.sh">
          <img src="https://sean.lane.sh/images/sean.png" alt="avatar" />
        </a>
      
      <a class="nav-title" href="https://sean.lane.sh">
        Sean Lane
      </a>
    </div>
  </section>
  <section class="pure-u-1 pure-u-md-1-3 nav-center">
    
      
        <a href="mailto:hi@sean.lane.sh"><i class="far fa-envelope fa-lg"></i></a>
      
        <a href="https://github.com/seanlane/"><i class="fab fa-github fa-lg"></i></a>
      
        <a href="https://www.linkedin.com/in/seantheolane"><i class="fab fa-linkedin fa-lg"></i></a>
      
        <a href="https://sean.lane.sh/posts/index.xml"><i class="fas fa-rss fa-lg"></i></a>
      
        <a href="https://twitter.com/seantheolane"><i class="fab fa-twitter fa-lg"></i></a>
      
    
  </section>
  <section class="pure-u-1 pure-u-md-1-3 nav-right">
    
      
        <a href="https://sean.lane.sh/">Home</a>
      
        <a href="https://sean.lane.sh/resume/">Resume</a>
      
        <a href="https://sean.lane.sh/posts/">Posts</a>
      
        <a href="https://sean.lane.sh/other/">Other</a>
      
    
  </section>
</nav>

    <main class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Odd Attribute Error from AWS boto3</h1>
        </div>
        <div class="post-meta pure-g">
          <div class="posted-on pure-u-1 pure-u-sm-1-3">
            <i class="fas fa-calendar"></i>
            <time datetime='2019-07-05T15:00:00-06:00'>
              July 5, 2019
            </time>
          </div>
          <div class="reading-time pure-u-1 pure-u-sm-1-3 post-center">
            <i class="fas fa-clock"></i>
            Reading time: 2 minutes
          </div>
          <div class="pure-u-1 pure-u-sm-1-3 post-right">
            
            <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://sean.lane.sh/tags/python/">python</a>
      <span class="separator">•</span>
    <a href="https://sean.lane.sh/tags/aws/">aws</a></div>

          </div>
        </div>
      </header>
      <div>
        <p>I&rsquo;ve been playing around with a side project that makes use of some server-less <a href="https://aws.amazon.com/lambda/">AWS Lambda</a> functions. I used a simple Flask app locally for testing, which took the place of the <a href="https://aws.amazon.com/api-gateway/">API Gateway</a>&rsquo;s role of getting server requests to the right function, and locally everything was testing fine. Note that within the Python AWS environment, the AWS credentials consisting of an Access Key ID and Secret Access Key are found as environment variables. In order to replicate this locally, I was creating environment variables with the Flask server, and then my functions would access these keys the same way:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Other imports....</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># === Determine if we&#39;re running in a Lambda function. =============================================</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    _ <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;AWS_REGION&#39;</span>]
</span></span><span style="display:flex;"><span>    in_lambda <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Not in Lambda environment</span>
</span></span><span style="display:flex;"><span>	in_lambda <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>secrets <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;AWS_ACCESS_KEY_ID&#34;</span>: os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#34;AWS_ACCESS_KEY_ID&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;AWS_SECRET_ACCESS_KEY&#34;</span>: os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#34;AWS_SECRET_ACCESS_KEY&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> in_lambda:
</span></span><span style="display:flex;"><span>    secrets[<span style="color:#e6db74">&#34;AWS_SESSION_TOKEN&#34;</span>] <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#34;AWS_SESSION_TOKEN&#34;</span>],
</span></span><span style="display:flex;"><span>    aws_session <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>Session(aws_access_key_id<span style="color:#f92672">=</span>secrets[<span style="color:#e6db74">&#34;AWS_ACCESS_KEY_ID&#34;</span>],
</span></span><span style="display:flex;"><span>                                        aws_secret_access_key<span style="color:#f92672">=</span>secrets[<span style="color:#e6db74">&#34;AWS_SECRET_ACCESS_KEY&#34;</span>],
</span></span><span style="display:flex;"><span>                                        aws_session_token<span style="color:#f92672">=</span>secrets[<span style="color:#e6db74">&#34;AWS_SESSION_TOKEN&#34;</span>],
</span></span><span style="display:flex;"><span>                                        region_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;us-east-2&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    aws_session <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>Session(aws_access_key_id<span style="color:#f92672">=</span>secrets[<span style="color:#e6db74">&#34;AWS_ACCESS_KEY_ID&#34;</span>],
</span></span><span style="display:flex;"><span>                                        aws_secret_access_key<span style="color:#f92672">=</span>secrets[<span style="color:#e6db74">&#34;AWS_SECRET_ACCESS_KEY&#34;</span>],
</span></span><span style="display:flex;"><span>										region_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;us-east-2&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Do stuff</span>
</span></span><span style="display:flex;"><span>s3 <span style="color:#f92672">=</span> aws_session<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;s3&#39;</span>)
</span></span></code></pre></div><p>Locally, this was working great, but when I went to test it on AWS, I was getting the following exception:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">AttributeError</span>: <span style="color:#e6db74">&#39;tuple&#39;</span> object has no attribute <span style="color:#e6db74">&#39;strip&#39;</span>
</span></span></code></pre></div><p>Digging through the exception, I found that the root of the exception came from the <code>botocore</code> package within the <code>botocore/auth.py</code> file at line 381<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, when the package is attempting to form a request and uses <code>self.credential.token</code> to form the <code>X-Amz-Security-Token</code>. For some reason that I&rsquo;m still not certain of, the above snippet would pass in the credentials as a tuple instead of a string, which would then eventually have the string method <code>strip</code> called on it to create the header value, and subsequently raise the exception.</p>
<p>Changing to the following has since mitigated the problem. Again, I&rsquo;m not quite sure why yet, but I spent too much time as it was on this and I&rsquo;ve currently left it here. Feel free to let me know what I&rsquo;ve missed, since I&rsquo;m certainly very new with using AWS Lambda and definitely could be missing something obvious or trivial.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Other imports....</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># === Determine if we&#39;re running in a Lambda function. =============================================</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    _ <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;AWS_REGION&#39;</span>]
</span></span><span style="display:flex;"><span>    in_lambda <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Not in Lambda environment</span>
</span></span><span style="display:flex;"><span>    in_lambda <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># === Load required environment variables and define AWS session ===================================</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> in_lambda:
</span></span><span style="display:flex;"><span>    aws_session <span style="color:#f92672">=</span> boto3
</span></span><span style="display:flex;"><span>    secrets <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Other secrets...</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    secrets <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;AWS_ACCESS_KEY_ID&#34;</span>: os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#34;AWS_ACCESS_KEY_ID&#34;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;AWS_SECRET_ACCESS_KEY&#34;</span>: os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#34;AWS_SECRET_ACCESS_KEY&#34;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    aws_session <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>Session(aws_access_key_id<span style="color:#f92672">=</span>secrets[<span style="color:#e6db74">&#34;AWS_ACCESS_KEY_ID&#34;</span>],
</span></span><span style="display:flex;"><span>                                        aws_secret_access_key<span style="color:#f92672">=</span>secrets[<span style="color:#e6db74">&#34;AWS_SECRET_ACCESS_KEY&#34;</span>],
</span></span><span style="display:flex;"><span>										region_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;us-east-2&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Do stuff</span>
</span></span><span style="display:flex;"><span>s3 <span style="color:#f92672">=</span> aws_session<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;s3&#39;</span>)
</span></span></code></pre></div><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://github.com/boto/botocore/blob/526f1e0322bf87e74f69c894245ce8506b86e597/botocore/auth.py#L388">GitHub: boto/botocore/auth.py</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

      </div>
      <div id="comments" class="comments">
    <h2>Comments</h2>
    <div id="comments-preamble">
        To leave a comment, <a href="https://github.com/seanlane/seanlane.github.io/issues/17">visit this post's issue page on GitHub.</a> 
        A GitHub account is required, since <a href="https://sean.lane.sh/posts/2016/01/Hosting-comments-within-issues-on-Github-Pages/">I host this site's comments on GitHub.</a>
    <div>
</div>
<script type="text/javascript" src="https://unpkg.com/jquery@3.3.1/dist/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js"></script>
<script type="text/javascript">
  function loadComments(data) {
    for (var i=0; i < data.length; i++) {
      var cuser = data[i].user.login;
      var cuserlink = "https://www.github.com/" + data[i].user.login;
      var clink = "https://github.com/seanlane\/seanlane.github.io/issues/17#issuecomment-" + 
          data[i].url.substring(data[i].url.lastIndexOf("/") + 1);
      var cbody = data[i].body_html;
      var cavatarlink = data[i].user.avatar_url;
      var cdate = Date.parse(data[i].created_at).setTimezone('UTC').toString("yyyy-MM-dd HH:mm:ss");

      $("#comments").append("<div class='comment'><div class='commentheader'><div class='commentgravatar'>" 
        + '<img src="' + cavatarlink + '" alt="" width="20" height="20">' 
        + "</div><a class='commentuser' href=\"" + cuserlink + "\">" 
        + cuser + "</a><a class='commentdate' href=\"" + clink 
        + "\">" + cdate + "</a></div><div class='commentbody'>" + cbody + "</div></div>");
    }
  }

  $.ajax("https://api.github.com/repos/seanlane\/seanlane.github.io/issues/17/comments", {
    headers: {Accept: "application/vnd.github.full+json"},
    success: function(msg){
      loadComments(msg);
    }
  });
</script>
      <footer>
        
      </footer>
    </article>
    
  </section>

    </main>
    <footer class="footer">
  
   © 2024
  
     · 
    Powered by <a href="https://gohugo.io/">Hugo</a> &amp; Extended from <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>
  
  
</footer>

    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-31520487-4', 'auto');
	
	ga('send', 'pageview');
}
</script>
  </body>
</html>